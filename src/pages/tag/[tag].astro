---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getAllTags, getPostsByTag, getPostUrl } from '../../utils/posts';

export async function getStaticPaths() {
  const tags = await getAllTags();
  return tags.map((tag) => ({
    params: { tag },
    props: { tag },
  }));
}

const { tag } = Astro.props;
const posts = await getPostsByTag(tag);
const displayTag = tag.charAt(0).toUpperCase() + tag.slice(1).replace(/-/g, ' ');
---

<BaseLayout title={`Posts tagged "${displayTag}"`}>
  <h2 class="text-2xl font-bold mb-6">
    Posts about "{displayTag}"
  </h2>

  {posts.length === 0 ? (
    <p class="text-light-text-secondary dark:text-dark-text-secondary">
      No posts found with this tag.
    </p>
  ) : (
    <div class="space-y-4">
      {posts.map((post) => (
        <PostCard
          title={post.data.title}
          date={post.data.date}
          tags={post.data.tags}
          url={getPostUrl(post)}
          excerpt={post.data.description}
        />
      ))}
    </div>
  )}

  <div class="mt-8">
    <a href="/" class="text-light-link dark:text-dark-link hover:underline">
      &larr; Back to all posts
    </a>
  </div>
</BaseLayout>
